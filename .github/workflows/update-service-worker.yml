name: Update Service Worker

on:
  push:
    branches:
      - main  # Executa o workflow apenas quando houver um push na branch "main"

permissions:
  contents: write  # Permiss칚o para escrita no reposit칩rio

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do c칩digo
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0  # Obt칠m o hist칩rico completo do reposit칩rio

      - name: Configurar identidade do Git
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"

      - name: Gerar nova vers칚o do Cache e for칞ar mudan칞a no Service Worker
        run: |
          SW_VERSION=$(date +%s)  # Gera um timestamp autom치tico 칰nico
          sed -i "s|const CACHE_VERSION = '.*';|const CACHE_VERSION = '$SW_VERSION';|" service-worker.js
          echo "" >> service-worker.js  # 游댠 Adiciona uma linha vazia para for칞ar uma mudan칞a no arquivo
          echo "Service Worker atualizado para vers칚o: $SW_VERSION"

      - name: Verificar mudan칞as antes do commit
        run: |
          if git diff --quiet; then
            echo "Nenhuma mudan칞a detectada. For칞ando modifica칞칚o para evitar erro."
            echo "# For칞ar atualiza칞칚o - $(date)" >> service-worker.js  # 游댠 Adiciona um coment치rio para for칞ar uma altera칞칚o real
            git add service-worker.js
          fi

      - name: Commit e push das mudan칞as
        run: |
          git add service-worker.js
          git commit -m "Atualiza칞칚o autom치tica do Service Worker (Build #$GITHUB_RUN_NUMBER)"
          git push origin main --force  # For칞a push para garantir que a mudan칞a entre
